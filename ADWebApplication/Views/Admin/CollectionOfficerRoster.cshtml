@model List<ADWebApplication.Models.Employee>

@{
    ViewData["Title"] = "Collection Officer Roster";
    Layout = "_Layout";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0"><i class="bi bi-people"></i> Collection Officer Roster</h2>
</div>
<div class="d-flex justify-content-between align-items-center mb-3">

    <form method="get" asp-action="CollectionOfficerRoster" class="d-flex align-items-center gap-3 flex-nowrap">

        <div class="d-flex align-items-center gap-2">
            <label class="mb-0 text-nowrap">Available From:</label>
            <input type="date" name="dateFrom" class="form-control" value="@Context.Request.Query["dateFrom"]"
                required />
        </div>

        <div class="d-flex align-items-center gap-2">
            <label class="mb-0 text-nowrap">Available To:</label>
            <input type="date" name="dateTo" class="form-control" value="@Context.Request.Query["dateTo"]" required />
        </div>

        <button type="submit" class="btn btn-primary text-nowrap">
            <i class="bi bi-check-circle"></i> Check Availability
        </button>
    </form>

    <div class="input-group w-auto">
        <span class="input-group-text">
            <i class="bi bi-search"></i>
        </span>
        <input type="text" id="searchBox" class="form-control" placeholder="Search..." onkeyup="filterTable()" />
    </div>

</div>



@if (Context.Request.Query.ContainsKey("dateFrom"))
{
    <div class="alert alert-info mt-2">
        Showing officers available from
        <strong>@Context.Request.Query["dateFrom"]</strong> to
        <strong>@Context.Request.Query["dateTo"]</strong>
    </div>
}


<table class="table table-striped table-bordered align-middle" id="officersTable">
    <thead class="table-primary">
        <tr>
            <th class="sortable" onclick="sortTable(0)"># <i class="bi bi-arrow-down-up"></i></th>
            <th id="usernameHeader" class="sortable" onclick="sortTable(1)">Username <i class="bi bi-arrow-down-up"></i>
            </th>
            <th id="fullNameHeader" class="sortable" onclick="sortTable(2)">Full Name <i
                    class="bi bi-arrow-down-up"></i></th>
            <th id="emailHeader" class="sortable" onclick="sortTable(3)">Email <i class="bi bi-arrow-down-up"></i></th>
            <th id="roleHeader" class="sortable" onclick="sortTable(4)">Role <i class="bi bi-arrow-down-up"></i></th>
            <th id="statusHeader" class="sortable" onclick="sortTable(5)">Status <i class="bi bi-arrow-down-up"></i>
            </th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null && Model.Any())
        {
            int count = 1;
            foreach (var officer in Model)
            {
                <tr>
                    <td class="count-cell">@count</td>
                    <td>@officer.Username</td>
                    <td>@officer.FullName</td>
                    <td>@officer.Email</td>
                    <td>@officer.Role?.Name</td>
                    <td>
                        @if (officer.IsActive)
                        {
                            <span class="badge bg-success">Active</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Inactive</span>
                        }
                    </td>
                    <td>
                        <!-- Route History Button -->
                        <a href="@Url.Action("CollectionOfficerSchedule", "Admin", new { officerUsername = officer.Username })"
                            class="btn btn-info btn-sm">
                            <i class="bi bi-clock"></i> Route History
                        </a>
                    </td>
                </tr>
                count++;
            }
        }
        else
        {
            <tr>
                <td colspan="7" class="text-center text-muted">No collection officers found.</td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script>
        // Sort the table by the column index
        function sortTable(columnIndex) {
            var table = document.getElementById("officersTable");
            var rows = Array.from(table.tBodies[0].rows);  // Get all rows in the tbody
            var isAscending = table.getAttribute("data-sort-order") === "asc";  // Check the current sort order

            // Toggle sort direction for clicked column
            isAscending = !isAscending;
            table.setAttribute("data-sort-order", isAscending ? "asc" : "desc");

            // Sort rows based on the content of the selected column (numeric or string)
            rows.sort(function (a, b) {
                var aText = a.cells[columnIndex].innerText.trim();
                var bText = b.cells[columnIndex].innerText.trim();

                var aNum = parseFloat(aText.replace(/,/g, ''));
                var bNum = parseFloat(bText.replace(/,/g, ''));

                // If column contains numbers, sort numerically
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return isAscending ? aNum - bNum : bNum - aNum;
                }

                // Else, sort by string (case-insensitive)
                return isAscending
                    ? aText.localeCompare(bText)
                    : bText.localeCompare(aText);
            });

            // Re-append sorted rows to the table
            rows.forEach(row => table.tBodies[0].appendChild(row));
        }

        // Search filter
        function filterTable() {
            var input = document.getElementById("searchBox");
            var filter = input.value.toLowerCase();
            var table = document.getElementById("officersTable");
            var rows = table.tBodies[0].rows;

            for (var i = 0; i < rows.length; i++) {
                rows[i].style.display = rows[i].innerText.toLowerCase().includes(filter) ? "" : "none";
            }
        }
    </script>
}