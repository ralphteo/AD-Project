
@model ADWebApplication.Models.CollectorRoute

@{
    ViewData["Title"] = "Collector Dashboard";
}

<div class="container py-4">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-4 p-4 bg-primary text-white rounded shadow-sm">
        <div>
            <h1 class="h2 fw-bold mb-1">Dashboard</h1>
            <p class="mb-0 opacity-75">Officer: @(User.FindFirst("FullName")?.Value ?? User.Identity?.Name ?? "Unknown") (CO-12345)</p>
        </div>
        <div class="text-end">
            <h6 class="mb-0 text-uppercase opacity-75">Today's Date</h6>
            <h4 class="mb-0">@DateTime.Now.ToString("dddd, MMM dd, yyyy")</h4>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-3 mb-4">
        <!-- Route Card -->
        <div class="col-md-3">
             <a asp-action="RouteDetails" asp-route-id="@Model.RouteId" class="text-decoration-none">
                <div class="card h-100 border-0 shadow-sm cursor-pointer hover-shadow">
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted small">Today's Route</span>
                            <i class="bi bi-map text-primary"></i>
                        </div>
                        <h3 class="fw-bold mb-1 text-dark">@Model.RouteName</h3>
                        <div class="text-muted small">@Model.Zone</div>
                    </div>
                </div>
            </a>
        </div>

        <!-- Completed Card -->
        <div class="col-md-3">
             <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted small">Completed</span>
                        <i class="bi bi-check-circle text-success"></i>
                    </div>
                    <h3 class="fw-bold mb-1">@Model.CompletedPoints<span class="text-muted fs-6">/@Model.TotalPoints</span></h3>
                    <div class="text-muted small">Collection points</div>
                </div>
            </div>
        </div>

        <!-- Weight Card -->
         <div class="col-md-3">
             <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted small">Total Weight</span>
                        <i class="bi bi-graph-up text-purple"></i>
                    </div>
                    <h3 class="fw-bold mb-1">@Model.TotalWeightCollected <span class="fs-6">kg</span></h3>
                    <div class="text-muted small">Collected today</div>
                </div>
            </div>
        </div>

        <!-- Status Card -->
         <div class="col-md-3">
             <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                     <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted small">Status</span>
                        <i class="bi bi-clock text-warning"></i>
                    </div>
                    <h3 class="fw-bold mb-1">@Model.Status</h3>
                    <div class="text-muted small">@(Model.TotalPoints - Model.CompletedPoints) points remaining</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Route Section -->
    <h4 class="fw-bold mb-3">Next Collection Points</h4>
    <div class="row">
        <div class="col-12">
            @foreach (var point in Model.CollectionPoints.Where(p => p.Status == "Pending").Take(3))
            {
                <div class="card mb-3 border-0 shadow-sm">
                    <div class="card-body d-flex align-items-center">
                        <!-- ID Circle -->
                        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px; font-weight: bold; font-size: 1.2rem;">
                            @point.PointId.Replace("CP-", "")
                        </div>
                        
                        <!-- Info -->
                        <div class="flex-grow-1">
                            <h5 class="fw-bold mb-1">@point.LocationName</h5>
                            <div class="text-muted mb-1">@point.Address</div>
                            <div class="d-flex align-items-center gap-3 text-small">
                                <span class="text-danger"><i class="bi bi-geo-alt-fill"></i> @point.DistanceKm km away</span>
                                <span class="text-muted"><i class="bi bi-stopwatch"></i> Est. @point.EstimatedTimeMins mins</span>
                                @if(point.CurrentFillLevel > 80)
                                {
                                    <span class="text-warning fw-bold"><i class="bi bi-exclamation-triangle-fill"></i> @point.CurrentFillLevel% Full</span>
                                }
                                else
                                {
                                     <span class="text-success fw-bold"><i class="bi bi-check-circle-fill"></i> @point.CurrentFillLevel% Full</span>
                                }
                            </div>
                        </div>

                        <!-- Action -->
                        <div>
                             <a href="https://www.google.com/maps/search/?api=1&query=@Uri.EscapeDataString(point.Address)" target="_blank" class="btn btn-primary px-4 rounded-pill">Navigate</a>
                        </div>
                    </div>
                </div>
            }
             @if (!Model.CollectionPoints.Any(p => p.Status == "Pending"))
            {
                <div class="alert alert-success text-center">
                    <h4>All collections completed for today!</h4>
                </div>
            }
            <div class="text-center mt-3">
                 <a asp-action="RouteDetails" asp-route-id="@Model.RouteId" class="btn btn-primary btn-lg w-100">
                    <i class="bi bi-map-fill me-2"></i> View Full Route
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Add Bootstrap Icons via CDN for this view -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
